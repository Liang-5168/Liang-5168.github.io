<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#970C10" />
  <title>唱給不在場的人</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700;900&display=swap" rel="stylesheet" />

  <style>
    /* =================================
      CSS 樣式區塊：完整保留所有設計風格
    ================================= */
    :root{
      --red:#970C10;
      --gold:#FFE87A;
      --ink:#000;
      --card:rgba(255,255,255,0.06);
      --card-border:rgba(255,255,255,0.14);
      --text:rgba(255,255,255,0.92);
      --muted:rgba(255,255,255,0.70);
      --focus:rgba(255,232,122,0.95);
      --navH: 92px;
    }

    *{margin:0;padding:0;box-sizing:border-box;}
    html{
      scroll-behavior:smooth;
      text-rendering:optimizeLegibility;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    body{
      font-family:"Noto Serif TC", serif;
      background:#000;
      color:#fff;
      overflow-x:hidden;
    }
    a{color:inherit;}
    a:focus-visible, button:focus-visible{
      outline:2px solid var(--focus);
      outline-offset:3px;
      border-radius:10px;
    }

    /* Skip link */
    .skip-link{
      position:absolute;
      left:-999px;
      top:10px;
      z-index:9999;
      background:rgba(0,0,0,0.85);
      border:1px solid rgba(255,255,255,0.20);
      color:#fff;
      padding:10px 12px;
      border-radius:12px;
      letter-spacing:0.08em;
    }
    .skip-link:focus{left:10px;}

    /* =========================
      Atmosphere: fog / smoke
    ========================== */
    .fog-layer{
      position:fixed;
      inset:-30vh -20vw -30vh -20vw;
      pointer-events:none;
      z-index:20;
      opacity:0.22;
      mix-blend-mode:screen;
      filter: blur(8px) contrast(110%);
      background:
        radial-gradient(closest-side at 20% 30%, rgba(255,255,255,0.16), rgba(255,255,255,0) 70%),
        radial-gradient(closest-side at 70% 55%, rgba(255,232,122,0.12), rgba(255,255,255,0) 72%),
        radial-gradient(closest-side at 35% 80%, rgba(255,255,255,0.14), rgba(255,255,255,0) 72%);
      animation:fog-drift 18s ease-in-out infinite;
    }
    .fog-layer::before,
    .fog-layer::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(closest-side at 55% 25%, rgba(255,255,255,0.10), rgba(255,255,255,0) 70%),
        radial-gradient(closest-side at 85% 75%, rgba(255,255,255,0.10), rgba(255,255,255,0) 70%),
        radial-gradient(closest-side at 10% 65%, rgba(255,255,255,0.08), rgba(255,255,255,0) 70%);
      animation:fog-drift-2 24s ease-in-out infinite;
      opacity:0.85;
      transform:translate3d(0,0,0);
    }
    .fog-layer::after{
      animation:fog-drift-3 30s ease-in-out infinite;
      opacity:0.55;
      filter: blur(12px);
    }
    @keyframes fog-drift{
      0%{transform:translate3d(-2vw, -1vh, 0) scale(1.02);}
      50%{transform:translate3d(2vw, 1.2vh, 0) scale(1.05);}
      100%{transform:translate3d(-2vw, -1vh, 0) scale(1.02);}
    }
    @keyframes fog-drift-2{
      0%{transform:translate3d(2vw, 0, 0) rotate(0.001deg);}
      50%{transform:translate3d(-2vw, 1vh, 0) rotate(0.001deg);}
      100%{transform:translate3d(2vw, 0, 0) rotate(0.001deg);}
    }
    @keyframes fog-drift-3{
      0%{transform:translate3d(0, 1vh, 0) scale(1.06);}
      50%{transform:translate3d(1.5vw, -1vh, 0) scale(1.02);}
      100%{transform:translate3d(0, 1vh, 0) scale(1.06);}
    }

    /* =========================
      Section 1｜Full-screen Video
    ========================== */
    .landing-video{
      position:relative;
      width:100%;
      height:100vh;
      overflow:hidden;
      background:#000;
    }
    .landing-video video{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
    }
    .landing-video::after{
      content:"";
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.28);
      z-index:1;
    }

    /* =========================
      Section 2｜Buffer Zone
    ========================== */
    .buffer{
      position:relative;
      height:60vh;
      background:var(--red);
      overflow:hidden;
    }
    .buffer::after{
      content:"";
      position:absolute;
      inset:0;
      background:url("assets/grain.png") repeat;
      opacity:0.25;
      pointer-events:none;
    }

    /* =========================
      Section 3｜Hero
    ========================== */
    .hero{
      position:relative;
      height:100vh;
      min-height:100vh;
      background:var(--red);
      overflow:visible;
      display:flex;
      align-items:center;
      padding:0 7vw;
      gap:min(6vw,64px);
      isolation:isolate;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:url("assets/grain.png") repeat;
      opacity:0.3;
      z-index:1;
    }
    .hero-image{
      position:absolute;
      right:0;
      bottom:0;
      display:flex;
      justify-content:flex-end;
      align-items:flex-end;
      z-index:2;
      pointer-events:none;
      filter:saturate(1.02) contrast(1.02);
    }
    .hero-image img{
      width:clamp(420px,60vw,920px);
      max-height:92vh;
      height:auto;
      object-fit:cover;
      border-top-left-radius:28px;
      box-shadow:0 30px 90px rgba(0,0,0,0.55);
    }
    .hero-content{
      position:relative;
      z-index:3;
      flex:0 1 48%;
      max-width:640px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      min-height:100%;
    }
    .hero h1{
      font-size:clamp(2.5rem,5vw,4rem);
      font-weight:900;
      color:var(--gold);
      margin-bottom:1rem;
      letter-spacing:0.05em;
    }
    .hero h2{
      font-size:clamp(1.4rem,3vw,2.2rem);
      font-weight:700;
      color:var(--gold);
      margin-bottom:1.5rem;
    }
    .hero h3{
      font-size:clamp(1rem,2.2vw,1.3rem);
      font-weight:600;
      color:#fff;
      letter-spacing:0.08em;
      margin-bottom:2rem;
    }
    .hero h1, .hero h2{white-space:nowrap;}

    .typewriter-line{
      display:inline-block;
      position:relative;
      min-height:1em;
      overflow:hidden;
    }
    .typewriter-line.typing::after{
      content:"";
      position:absolute;
      right:-0.1em;
      top:50%;
      transform:translateY(-50%);
      height:1.2em;
      width:2px;
      background:var(--gold);
      animation:caret-blink 0.8s steps(1) infinite;
    }
    .typewriter-line.done::after{animation:none;opacity:0;}

    .hero-entrance{
      opacity:0;
      transform:translateY(20px);
      transition:opacity 0.9s ease-out, transform 0.9s ease-out;
      transition-delay:var(--delay,0ms);
    }
    .hero-entrance.is-visible{opacity:1;transform:translateY(0);}

    .scroll-hint{
      position:absolute;
      bottom:3rem;
      left:50%;
      transform:translate(-50%,0.5rem);
      font-size:0.9rem;
      letter-spacing:0.3em;
      text-transform:uppercase;
      color:rgba(255,255,255,0.85);
      opacity:0;
      transition:opacity 0.6s ease, transform 0.6s ease;
      pointer-events:none;
      z-index:4;
    }
    .scroll-hint.visible{
      opacity:1;
      transform:translate(-50%,0);
      animation:hint-float 2s ease-in-out infinite;
    }

    @keyframes caret-blink{0%,49%{opacity:1;}50%,100%{opacity:0;}}
    @keyframes hint-float{0%{transform:translate(-50%,0);}50%{transform:translate(-50%,-8px);}100%{transform:translate(-50%,0);}}

    /* =========================
      Sticky Mini Nav + Progress
    ========================== */
    .mini-nav{
      position:sticky;
      top:0;
      z-index:60;
      backdrop-filter:blur(10px);
      background:rgba(0,0,0,0.55);
      border-bottom:1px solid rgba(255,255,255,0.10);
    }
    .mini-nav-inner{
      display:flex;
      align-items:center;
      gap:1rem;
      padding:0.75rem 6vw 0.65rem;
      overflow-x:auto;
      scrollbar-width:none;
    }
    .mini-nav-inner::-webkit-scrollbar{display:none;}
    .mini-nav a{
      color:rgba(255,255,255,0.78);
      text-decoration:none;
      font-size:0.9rem;
      letter-spacing:0.12em;
      white-space:nowrap;
      padding:0.35rem 0.65rem;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      transition:0.25s ease;
    }
    .mini-nav a:hover{color:#fff;border-color:rgba(255,255,255,0.24);}
    .mini-nav a.active{color:#000;background:var(--gold);border-color:transparent;}

    .progressbar{
      height:3px;
      background:rgba(255,255,255,0.10);
      margin:0 6vw 0.65rem;
      border-radius:999px;
      overflow:hidden;
    }
    .progressbar > div{
      height:100%;
      width:0%;
      background:var(--gold);
      border-radius:999px;
      transition:width 0.1s linear;
    }

    /* =========================
      Chapters Base
    ========================== */
    main{display:block;}
    .chapter{
      background:#000;
      padding:14vh 8vw;
      position:relative;
      isolation:isolate;
    }
    .chapter-inner{max-width:980px;margin:0 auto;}
    .kicker{
      color:rgba(255,255,255,0.7);
      letter-spacing:0.18em;
      font-size:0.9rem;
      margin-bottom:1.2rem;
      text-transform:uppercase;
    }
    .chapter h2{
      font-size:clamp(1.8rem,3.5vw,2.8rem);
      font-weight:900;
      letter-spacing:0.06em;
      margin-bottom:1.1rem;
      color:var(--gold);
    }
    .chapter p{
      font-size:clamp(1.05rem,1.6vw,1.2rem);
      line-height:1.95;
      color:var(--text);
      margin:0.9rem 0;
    }
    .chapter strong{color:rgba(255,255,255,0.98);}
    .note{
      color:rgba(255,255,255,0.72);
      font-size:0.98rem;
      line-height:1.85;
    }
    .hr{
      height:1px;
      background:rgba(255,255,255,0.12);
      margin:2.2rem 0;
    }

    /* reveal */
    .reveal{
      opacity:0;
      transform:translateY(14px);
      transition:opacity 0.8s ease, transform 0.8s ease;
    }
    .reveal.is-visible{opacity:1;transform:translateY(0);}

    /* =========================
      Sticky Compare / Sticky Narrative
    ========================== */
    .sticky-section{
      background:var(--red);
      padding:0;
      overflow:hidden;
    }
    .sticky-section::before{
      content:"";
      position:absolute;
      inset:0;
      background:url("assets/grain.png") repeat;
      opacity:0.28;
      pointer-events:none;
      z-index:0;
    }
    .sticky-wrap{
      position:relative;
      z-index:1;
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap:min(5vw,60px);
      padding:12vh 8vw;
      align-items:start;
    }
    .sticky-media{
      position:sticky;
      top:calc(var(--navH) + 8px);
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.25);
      box-shadow:0 30px 80px rgba(0,0,0,0.45);
      isolation:isolate;
    }
    .sticky-media img, .sticky-media video{
      width:100%;
      height:min(72vh,720px);
      object-fit:cover;
      display:block;
    }
    .sticky-media::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(to bottom, rgba(0,0,0,0.14), rgba(0,0,0,0.38));
      pointer-events:none;
      z-index:2;
    }

    .sticky-text{
      padding-bottom:20vh;
    }
    .sticky-text .lead{
      color:rgba(255,255,255,0.88);
      font-size:clamp(1.1rem,1.8vw,1.25rem);
      line-height:1.95;
      margin:0.8rem 0 1.2rem;
    }
    .sticky-step{
      margin:0;
      padding:1.1rem 1.1rem;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(0,0,0,0.18);
      transition:background 0.35s ease, border-color 0.35s ease, transform 0.35s ease;
      transform:translateY(0);
    }
    .sticky-step + .sticky-step{margin-top:1rem;}
    .sticky-step .label{
      display:block;
      letter-spacing:0.18em;
      text-transform:uppercase;
      font-size:0.82rem;
      color:rgba(255,255,255,0.70);
      margin-bottom:0.35rem;
    }
    .sticky-step.is-active{
      background:rgba(0,0,0,0.34);
      border-color:rgba(255,255,255,0.20);
      transform:translateY(-2px);
    }
    .sticky-step.is-active .label{color:rgba(255,232,122,0.85);}
    .sticky-step.is-active .text{color:rgba(255,255,255,0.98);}
    .sticky-step .text{
      color:rgba(255,255,255,0.86);
      font-size:clamp(1.05rem,1.7vw,1.2rem);
      line-height:1.95;
    }

    /* Tooltip */
    .tip{
      position:relative;
      border-bottom:1px dashed rgba(255,255,255,0.55);
      cursor:help;
    }
    .tip:hover::after{
      content:attr(data-tip);
      position:absolute;
      left:0;
      top:1.7em;
      width:min(320px,70vw);
      padding:10px 12px;
      background:rgba(0,0,0,.90);
      color:#fff;
      border:1px solid rgba(255,255,255,0.15);
      border-radius:14px;
      font-size:0.95rem;
      line-height:1.5;
      z-index:20;
    }

    /* =========================
      Chapter 03: order stage (scroll-lit)
    ========================== */
    .order-stage{
      border-radius:24px;
      padding:1.4rem 1.4rem 1.2rem;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(0,0,0,0.22);
      transition:background 0.8s ease, border-color 0.8s ease, filter 0.8s ease;
      filter:brightness(0.6) saturate(0.95);
    }
    .order-stage.is-lit{
      background:rgba(0,0,0,0.34);
      border-color:rgba(255,255,255,0.22);
      filter:brightness(1) saturate(1);
    }
    .order-stage p{margin:0.75rem 0;}

    /* =========================
      Horizontal Exhibit (Chapter 04)
    ========================== */
    .hscroll{
      padding:0;
      background:var(--red);
      position:relative;
      overflow:hidden;
    }
    .hscroll::before{
      content:"";
      position:absolute;
      inset:0;
      background:url("assets/grain.png") repeat;
      opacity:0.28;
      pointer-events:none;
      z-index:0;
    }
    .hscroll-head{
      position:relative;
      z-index:2;
      padding:12vh 8vw 4vh;
      max-width:980px;
      margin:0 auto;
    }
    .hscroll-head .note{color:rgba(255,255,255,0.74);}
    .hscroll-pin{
      position:sticky;
      top:var(--navH);
      height:calc(100vh - var(--navH));
      overflow:hidden;
      z-index:2;
      border-top:1px solid rgba(255,255,255,0.10);
      border-bottom:1px solid rgba(255,255,255,0.10);
      background:rgba(0,0,0,0.12);
    }
    .hscroll-track{
      height:100%;
      display:flex;
      width:600vw; /* 6 panels */
      transform:translateX(0px);
      will-change:transform;
      transition:transform 0.06s linear;
    }
    .panel{
      width:100vw;
      height:100%;
      padding:8vh 8vw;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:min(5vw,60px);
      align-items:center;
    }
    .panel .panel-media{
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.25);
      box-shadow:0 30px 80px rgba(0,0,0,0.45);
      position:relative;
      isolation:isolate;
    }
    .panel .panel-media img,
    .panel .panel-media video{
      width:100%;
      height:min(60vh,620px);
      object-fit:cover;
      display:block;
    }
    .panel .panel-media::after{
      content:"";
      position:absolute;
      inset:0;
      background:linear-gradient(to bottom, rgba(0,0,0,0.12), rgba(0,0,0,0.35));
      pointer-events:none;
      z-index:2;
    }
    .panel h3{
      font-size:clamp(1.8rem,3vw,2.4rem);
      font-weight:900;
      color:var(--gold);
      letter-spacing:0.12em;
      margin-bottom:0.55rem;
    }
    .panel .tagline{
      font-size:0.92rem;
      letter-spacing:0.22em;
      color:rgba(255,255,255,0.66);
      margin-bottom:1.0rem;
      text-transform:uppercase;
    }
    .panel .desc{
      color:rgba(255,255,255,0.90);
      font-size:clamp(1.05rem,1.6vw,1.2rem);
      line-height:1.95;
      margin:0.6rem 0 1.1rem;
    }
    .panel .cta{
      display:inline-flex;
      align-items:center;
      gap:0.55rem;
      font-size:0.95rem;
      letter-spacing:0.12em;
      color:rgba(255,255,255,0.88);
      user-select:none;
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.20);
      background:rgba(0,0,0,0.16);
      padding:0.55rem 0.85rem;
      border-radius:999px;
      transition:0.25s ease;
    }
    .panel .cta:hover{
      border-color:rgba(255,255,255,0.32);
      background:rgba(0,0,0,0.26);
    }
    .hscroll-spacer{
      height:520vh;
      background:var(--red);
      position:relative;
      z-index:1;
    }

    /* =========================
      Scrolled Video (Chapter 05)
    ========================== */
    .sv-wrap{
      display:grid;
      grid-template-columns: 1.05fr 0.95fr;
      gap:min(5vw,60px);
      align-items:start;
      margin-top:2.0rem;
    }
    .sv-video{
      position:sticky;
      top:calc(var(--navH) + 8px);
      border-radius:22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.03);
      box-shadow:0 30px 80px rgba(0,0,0,0.45);
    }
    .sv-video video{
      width:100%;
      height:min(72vh,720px);
      object-fit:cover;
      display:block;
      background:#000;
    }
    .sv-lines{
      padding-bottom:30vh;
    }
    .sv-line{
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.04);
      padding:1.1rem 1.1rem;
      margin:0 0 1rem;
      transition:background 0.35s ease, border-color 0.35s ease, transform 0.35s ease;
    }
    .sv-line .who{
      margin-top:0.55rem;
      color:rgba(255,255,255,0.65);
      font-size:0.95rem;
      letter-spacing:0.08em;
    }
    .sv-line.is-active{
      background:rgba(255,255,255,0.08);
      border-color:rgba(255,255,255,0.18);
      transform:translateY(-2px);
    }
    .sv-line.is-active .quoteText{
      color:rgba(255,255,255,0.98);
    }
    .sv-line .quoteText{
      color:rgba(255,255,255,0.84);
      font-size:clamp(1.05rem,1.6vw,1.2rem);
      line-height:1.95;
    }

    /* =========================
      Modal
    ========================== */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.72);
      z-index:120;
      display:none;
      align-items:center;
      justify-content:center;
      padding:6vh 6vw;
    }
    .modal-backdrop.open{display:flex;}
    .modal{
      width:min(980px,100%);
      max-height:86vh;
      overflow:auto;
      background:rgba(10,10,10,0.96);
      border:1px solid rgba(255,255,255,0.16);
      border-radius:24px;
      padding:1.4rem 1.4rem 1.2rem;
      box-shadow:0 30px 80px rgba(0,0,0,0.6);
    }
    .modal-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:1rem;
      margin-bottom:0.8rem;
    }
    .modal-title{
      font-size:1.6rem;
      font-weight:900;
      color:var(--gold);
      letter-spacing:0.10em;
    }
    .modal-close{
      appearance:none;
      border:1px solid rgba(255,255,255,0.20);
      background:rgba(255,255,255,0.06);
      color:rgba(255,255,255,0.92);
      border-radius:999px;
      padding:0.55rem 0.85rem;
      cursor:pointer;
      font-size:0.95rem;
      letter-spacing:0.12em;
    }
    .modal-close:hover{border-color:rgba(255,255,255,0.28);}
    .modal-body p{margin:0.8rem 0;}
    .modal-media{margin-top:1rem;}
    .modal-media video, .modal-media img{
      width:100%;
      border-radius:18px;
      display:block;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.03);
    }
    .modal-caption{
      margin-top:0.7rem;
      color:rgba(255,255,255,0.72);
      font-size:0.95rem;
      line-height:1.6;
    }

    /* =========================
      Reduced Motion
    ========================== */
    @media (prefers-reduced-motion: reduce){
      html{scroll-behavior:auto !important;}
      *{scroll-behavior:auto !important;}
      .hero-entrance,.reveal{transition:none !important;transform:none !important;}
      .scroll-hint{animation:none !important;}
      .typewriter-line.typing::after{animation:none !important;}
      .fog-layer{animation:none !important;}
      .fog-layer::before,.fog-layer::after{animation:none !important;}
      .hscroll-track{transition:none !important;}
    }

    /* =========================
      Mobile
    ========================== */
    @media (max-width: 900px){
      :root{ --navH: 86px; }
      .sticky-wrap, .sv-wrap{grid-template-columns:1fr;}
      .sticky-media, .sv-video{top:calc(var(--navH) + 8px);}
      .sticky-media img, .sticky-media video, .sv-video video{height:56vh;}
      .panel{
        grid-template-columns:1fr;
        align-content:start;
        padding:6vh 8vw;
      }
      .panel .panel-media img, .panel .panel-media video{height:40vh;}
    }
    @media (max-width: 768px){
      .hero{padding:4vh 8vw;}
      .hero-content{flex:1 1 auto;min-height:auto;}
      .hero-image{right:-5vw;bottom:1rem;opacity:0.62;}
      .hero-image img{width:min(78vw,420px);max-height:60vh;}
      .hero h1,.hero h2{white-space:normal;}
      .scroll-hint{letter-spacing:0.2em;bottom:2rem;}
      .mini-nav-inner{padding:0.65rem 6vw 0.55rem;}
      .progressbar{margin:0 6vw 0.55rem;}
    }
  </style>
</head>

<body>
  <a class="skip-link" href="#main">跳到正文</a>
  <div class="fog-layer" aria-hidden="true"></div>

    <section class="landing-video" aria-label="開場舞台影片">
    <video
      id="landing-video"
      src="assets/stage.mp4"
      autoplay
      muted
      loop
      playsinline
      preload="auto"></video>
  </section>

    <section class="buffer" aria-hidden="true"></section>

    <section class="hero" aria-label="專題標題">
    <div class="hero-content">
      <h1 id="hero-title" class="typewriter-line hero-entrance" data-text="唱給不在場的人" style="--delay:0ms;"></h1>
      <h2 id="hero-subtitle" class="typewriter-line hero-entrance" data-text="紅包歌手的世代誤解與生存現場" style="--delay:150ms;"></h2>
      <h3 id="hero-author" class="hero-author hero-entrance" style="--delay:300ms;">梁朝勛、彭賀琳、莊馨予</h3>
    </div>

    <div class="hero-image hero-entrance" style="--delay:0ms;">
            <img
        src="assets/img/yang-yaqiao.jpg"
        alt="紅包場歌手楊雅喬"
        decoding="async"
        loading="eager"
        fetchpriority="high">
    </div>

    <div id="scroll-hint" class="scroll-hint">SCROLL ↓</div>
  </section>

    <nav class="mini-nav" aria-label="章節導覽">
    <div class="mini-nav-inner" role="navigation">
      <a href="#chapter-hook" data-section="chapter-hook">01 HOOK</a>
      <a href="#chapter-redpacket" data-section="chapter-redpacket">02 紅包</a>
      <a href="#chapter-order" data-section="chapter-order">03 秩序</a>
      <a href="#chapter-elements" data-section="chapter-elements">04 六大元素</a>
      <a href="#chapter-interviews" data-section="chapter-interviews">05 訪談</a>
    </div>
    <div class="progressbar" aria-hidden="true"><div id="progress-fill"></div></div>
  </nav>

  <main id="main">
        <section class="chapter sticky-section" id="chapter-hook" aria-label="章節一：紅包場與刻板印象">
      <div class="sticky-wrap">
        <div class="sticky-media" aria-hidden="true">
          <img
            id="compare-media"
            src="assets/photo/DSC04754.jpg"
            alt="紅包場內景"
            loading="eager"
            decoding="async">
        </div>

        <div class="sticky-text">
          <div class="kicker reveal">CHAPTER 01</div>
          <h2 class="reveal">紅包場，和你想的不一樣</h2>
          <p class="lead reveal">把它誤會成「某種刺激消費」很容易；但真正的樣貌，往往只在你坐下來之後，才慢慢浮現。</p>

          <div class="sticky-step reveal js-sticky-step is-active"
            data-media="assets/photo/DSC04754.jpg">
            <span class="label">COMPARE 01</span>
            <div class="text">它常被拿來和 <span class="tip" data-tip="紅包場不以「清涼」或「火辣」為賣點">牛肉場</span>混為一談，但紅包場的核心是「聽歌」：觀眾把注意力給表演，歌手把完整的演出給舞台。</div>
          </div>

          <div class="sticky-step reveal js-sticky-step"
            data-media="assets/img/singer.jpg">
            <span class="label">COMPARE 02</span>
            <div class="text">它也不等同 <span class="tip" data-tip="紅包場是老少宜的場所">舞廳</span>。紅包場裡，主角始終在台上，秩序與默契反而更像一套「固定座位的劇場」。</div>
          </div>

          <div class="sticky-step reveal js-sticky-step"
            data-media="assets/photo/DSC04900.jpg">
            <span class="label">COMPARE 03</span>
            <div class="text">你可以把它和 <span class="tip" data-tip="紅包場觀眾不會上台唱歌">卡拉OK</span>區分開來：紅包場觀眾多半不登台，點歌、聽歌、聊天，維持的是「台上台下」的距離。</div>
          </div>

          <div class="sticky-step reveal js-sticky-step"
            data-media="assets/photo/DSC09319.jpg">
            <span class="label">COMPARE 04</span>
            <div class="text">它也不同於 <span class="tip" data-tip="紅包場歌手需要穿著「禮服」上台">Livehouse</span>。紅包場的舞台更像「秀場」：禮服、燈光、稱號、流程，構成一種職業規範。</div>
          </div>

          <div class="sticky-step reveal js-sticky-step"
            data-media="assets/photo/DSC09375.jpg">
            <span class="label">COMPARE 05</span>
            <div class="text">更別說 <span class="tip" data-tip="紅包場的觀眾是特地來聽歌的">流水席</span>：紅包場的觀眾是為了歌而來，餐飲只是把時間留在現場的方式。</div>
          </div>
        </div>
      </div>
    </section>

        <section class="chapter sticky-section" id="chapter-redpacket" aria-label="章節二：紅包的意義">
      <div class="sticky-wrap">
        <div class="sticky-media">
          <video id="redpacket-loop" muted loop playsinline preload="metadata" poster="assets/photo/DSC09375.jpg">
            <source src="assets/video/c0621.mp4" type="video/mp4" />
          </video>
        </div>

        <div class="sticky-text">
          <div class="kicker reveal">CHAPTER 02</div>
          <h2 class="reveal">紅包的意義：支持表演，而不是購買身體</h2>

          <p class="lead reveal">把「紅包」理解成交易，很快；但在現場，它更像一種回應：喜歡、尊重、面子、人情，最後都落在一個小小的信封裡。</p>

          <div class="sticky-step reveal js-sticky-step-2 is-active"
            data-media="assets/photo/DSC04754.jpg"
            data-kind="img">
            <span class="label">POINT 01</span>
            <div class="text">紅包場是歌手、表演者與觀眾最直接互動的地方。觀眾用紅包表達喜歡，歌手用表演回應掌聲。</div>
          </div>

          <div class="sticky-step reveal js-sticky-step-2"
            data-media="assets/img/redpacket.jpg"
            data-kind="img">
            <span class="label">POINT 02</span>
            <div class="text">紅包不是對身體的購買，而是對「表演」的支持；觀眾來聽歌、點歌、聊天，建立的是長時間的人情關係。</div>
          </div>

          <div class="sticky-step reveal js-sticky-step-2"
            data-media="assets/photo/DSC09375.jpg"
            data-kind="img">
            <span class="label">POINT 03</span>
            <div class="text">紅包場的文化內涵，來自「茶單」制度：歌星承擔賓客的飲食消費，賓客則包高出消費金額的紅包交給所捧場的歌星。</div>
          </div>

          <div class="sticky-step reveal js-sticky-step-2"
            data-media="assets/img/assistant.jpg"
            data-kind="img">
            <span class="label">POINT 04</span>
            <div class="text">多出來的金額成為鼓勵，也讓「紅包」成為關係的可見形式：不是一次性的刺激消費，而是累積的信任與照顧。</div>
          </div>
        </div>
      </div>
    </section>

        <section class="chapter" id="chapter-order" aria-label="章節三：仍在運作的秩序">
      <div class="chapter-inner">
        <div class="kicker reveal">CHAPTER 03</div>
        <h2 class="reveal">一個仍在運作的秩序</h2>

        <div class="order-stage reveal" id="order-stage">
          <p class="js-order-line">坐進觀眾席後，紅包場的日常很快展開。茶水與水果盤被送上桌，「小妹」在場內來回穿梭，確認每一桌的狀態。</p>
          <p class="js-order-line">對第一次進場的人來說，這套秩序未必容易理解：座位距離近，舞台與觀眾幾乎沒有明確分界；任何多餘的動作，都顯得突兀。</p>
          <p class="js-order-line">這種不自在，並非來自危險或衝突，而是來自——<strong>不知道自己該如何被放進這個空間</strong>。</p>
        </div>

        <div class="hr reveal"></div>

        <p class="reveal js-order-line">在現場，新面孔很少被直接問「覺得好不好」。更常出現的，是另一個問題：<strong>「怎麼會來這裡？」</strong></p>
        <p class="note reveal js-order-line">年輕人的出現往往被理解成「帶著目的」：作業、報導、拍攝、找題材。於是紅包場面對新世代時，常同時帶著開放與防備。</p>
      </div>
    </section>

        <section class="chapter hscroll" id="chapter-elements" aria-label="章節四：六大元素">
      <div class="hscroll-head">
        <div class="kicker reveal">CHAPTER 04</div>
        <h2 class="reveal">撐起紅包場的人與物</h2>
        <p class="reveal">把六大元素做成走廊式展覽：你不是讀清單，而是被帶著走進場內，逐一看見系統如何運作。</p>
        <p class="note reveal">操作：慢慢往下捲（這段會橫向推進）。點「展開更多」可打開深度素材。</p>
      </div>

      <div class="hscroll-pin" aria-hidden="false">
        <div class="hscroll-track" id="hscroll-track">
                    <section class="panel"
            data-title="歌星"
            data-subtitle="THE SINGER"
            data-body="歌星輪番登台，每人2-3首歌曲的時間，跑馬燈穿過個人稱號，歌星穿著禮服盛裝登場，帶來經典好歌，除了手工製作演唱服裝，更拜師學歌藝精益求精，透過舞台展現自信與對歌唱的喜愛，演出期間嚴守在台上不會走到台下，在歌廳盛行的年代，還要連跑好幾場，盛況空前，紅包場也捧紅眾多電視新星。"
            data-media-type="img"
            data-media-src="assets/img/singer.jpg"
            data-media-caption="舞台上的歌星 (assets/img/singer.jpg)">
            <div>
              <h3>歌星</h3>
              <div class="tagline">THE SINGER</div>
              <div class="desc">輪番登台、禮服盛裝。二到三首歌的時間，是一輩子累積的職業身段。</div>
              <button class="cta js-open-modal" type="button">＋ 展開更多</button>
            </div>
            <div class="panel-media">
              <img src="assets/img/singer.jpg" alt="歌星｜舞台畫面" loading="lazy" decoding="async">
            </div>
          </section>

                    <section class="panel"
            data-title="樂團老師"
            data-subtitle="THE BAND"
            data-body="樂團老師全天候在舞臺後方，對於鼓、效果器、各式新舊歌曲高度熟悉，偶爾搭配上自身的合音，為每場歌星演唱增添風情，透過1至2位樂團老師，現場的音場讓人穿梭時空，感受情調並隨之舞動。"
            data-media-type="img"
            data-media-src="assets/img/band.jpg"
            data-media-caption="舞台後方、鼓組與音效設備 (assets/img/band.jpg)">
            <div>
              <h3>樂團老師</h3>
              <div class="tagline">THE BAND</div>
              <div class="desc">一到兩位老師撐起全場音場。鼓點與合音，讓情緒在年代之間流動。</div>
              <button class="cta js-open-modal" type="button">＋ 展開更多</button>
            </div>
            <div class="panel-media">
              <img src="assets/img/band.jpg" alt="舞台｜器材與燈光" loading="lazy" decoding="async">
            </div>
          </section>

                    <section class="panel"
            data-title="小妹"
            data-subtitle="THE CONNECTOR"
            data-body="在場內穿梭的小妹擔任服務生的角色，在端茶、倒水、引導客人包紅包方式之外，成為歌星穩固業績、建立關係的重要搭擋。歌廳也會規定禁止搶客，否則會遭人側目嘴舌。"
            data-media-type="img"
            data-media-src="assets/img/assistant.jpg"
            data-media-caption="場內服務與走動的背影 (assets/img/assistant.jpg)">
            <div>
              <h3>小妹</h3>
              <div class="tagline">THE CONNECTOR</div>
              <div class="desc">穿梭場內、送茶引位、協助包紅包。她是秩序的流動節點，也是關係的媒介。</div>
              <button class="cta js-open-modal" type="button">＋ 展開更多</button>
            </div>
            <div class="panel-media">
              <img src="assets/photo/DSC09375.jpg" alt="桌面｜茶水與水果盤" loading="lazy" decoding="async">
            </div>
          </section>

                    <section class="panel"
            data-title="服裝"
            data-subtitle="THE COSTUME"
            data-body="每位歌星在登場前會提早至舞台旁的服裝間換衣服，每件禮服、表演服裝的背後都有特製、手工製作等獨特故事，紅包場中的服裝也因歌星的個人風格、偏好息息相關，比如黑色的沈著低調、亮綠色的活潑外向，又甚至是帽子、首飾等搭配都有所學問，彰顯每次歌唱呈現背後的用心累積。"
            data-media-type="img"
            data-media-src="assets/img/costume.jpg"
            data-media-caption="手工或訂製的禮服與更衣空間 (assets/img/costume.jpg)">
            <div>
              <h3>服裝</h3>
              <div class="tagline">THE COSTUME</div>
              <div class="desc">手作或訂製的禮服，是歌唱之外的另一種創作：把年代、性格與舞台放在身上。</div>
              <button class="cta js-open-modal" type="button">＋ 展開更多</button>
            </div>
            <div class="panel-media">
              <img src="assets/img/costume.jpg" alt="服裝｜更衣空間與衣物" loading="lazy" decoding="async">
            </div>
          </section>

                    <section class="panel"
            data-title="餐飲"
            data-subtitle="THE TABLE"
            data-body="在桌面常見的像是瓜子、水果盤，或者是普洱、烏龍、清茶等選項，隨著經營者的商業考量，也會有熱炒、啤酒，有時也會由歌星個人推薦或贈送像是炒花生、果醬等增進情感，點餐與結款將以「茶單制」進行，用餐區域多以舞台現場開放空間為主，開包廂者較少數。"
            data-media-type="img"
            data-media-src="assets/img/food.jpg"
            data-media-caption="桌面日常：茶水、水果盤、瓜子 (assets/img/food.jpg)">
            <div>
              <h3>餐飲</h3>
              <div class="tagline">THE TABLE</div>
              <div class="desc">茶水、水果盤、熱炒與啤酒。在茶單制裡，餐飲也是人情往來的日常語言。</div>
              <button class="cta js-open-modal" type="button">＋ 展開更多</button>
            </div>
            <div class="panel-media">
              <img src="assets/img/food.jpg" alt="餐飲｜茶水與水果盤" loading="lazy" decoding="async">
            </div>
          </section>

                    <section class="panel"
            data-title="紅包"
            data-subtitle="THE RED ENVELOPE"
            data-body="紅包場最經典的畫面，是歌星演唱期間，透過聽眾或小妹，親手由臺下交付紅包給予歌星，紅包內的金額，無論是100元、300元、1000元皆隨心隨緣，過往如需凸顯個人，也會將大面額的鈔票露出，為喜愛的歌星「做面子」，甚至有觀眾爭相包紅包的景象。紅包是對表演的支持、是長期關係的證明。"
            data-media-type="img"
            data-media-src="assets/img/redpacket.jpg"
            data-media-caption="紅包交付瞬間 (assets/img/redpacket.jpg)">
            <div>
              <h3>紅包</h3>
              <div class="tagline">THE RED ENVELOPE</div>
              <div class="desc">紅包不是交易，而是支持與面子、人情、記憶的可見形式。</div>
              <button class="cta js-open-modal" type="button">＋ 展開更多</button>
            </div>
            <div class="panel-media">
              <img src="assets/img/redpacket.jpg" alt="紅包｜交付瞬間" loading="lazy" decoding="async">
            </div>
          </section>
        </div>
      </div>

      <div class="hscroll-spacer" id="hscroll-spacer" aria-hidden="true"></div>
    </section>

        <section class="chapter" id="chapter-interviews" aria-label="章節五：訪談精華">
      <div class="chapter-inner">
        <div class="kicker reveal">CHAPTER 05</div>
        <h2 class="reveal">他們怎麼說：讓影像成為證據</h2>
        <p class="reveal">你捲到哪一句，影片就跳到對應時間點。</p>

        <div class="sv-wrap">
          <div class="sv-video reveal">
            <video id="sv-video" controls preload="metadata" playsinline poster="assets/photo/DSC09448.jpg">
              <source id="sv-source" src="assets/video/c0662.mp4" type="video/mp4" />
              你的瀏覽器不支援影片播放。
            </video>
        </div>

          <div class="sv-lines">
            <div class="sv-line reveal js-sv-line is-active" data-src="assets/video/c0662.mp4" data-poster="assets/img/yang-yaqiao.jpg" data-time="0">
              <div class="quoteText">「臺上臺下，我是不一樣的人。」</div>
              <div class="who">— 楊雅喬</div>
            </div>

            <div class="sv-line reveal js-sv-line" data-src="assets/video/c0626.mp4" data-poster="assets/img/jin-ziyan.jpg" data-time="18">
              <div class="quoteText">「這些對我們來講是很普通的事情，但對你們來說很感動。」</div>
              <div class="who">— 翟曼芳</div>
            </div>

            <div class="sv-line reveal js-sv-line" data-src="assets/video/c0621.mp4" data-poster="assets/img/redpacket.jpg" data-time="42">
              <div class="quoteText">「歌廳假如沒有了，其他地方也沒有我們生存的空間了……」</div>
              <div class="who">— 翟曼芳</div>
            </div>

            <div class="sv-line reveal js-sv-line" data-src="assets/video/c0662.mp4" data-poster="assets/img/singer.jpg" data-time="63">
              <div class="quoteText">「你們怎麼會來這裡？」</div>
              <div class="who">— 場內常見的第一句話</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

    <div class="modal-backdrop" id="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="modal-title">標題</div>
          <div class="note" id="modal-subtitle" style="margin-top:.35rem;">SUBTITLE</div>
        </div>
        <button class="modal-close" id="modal-close" type="button" aria-label="關閉視窗">關閉</button>
        </div>

      <div class="modal-body" id="modal-body"></div>
      <div class="modal-media" id="modal-media"></div>
      <div class="modal-caption" id="modal-caption"></div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const $$ = (s, root=document) => Array.from(root.querySelectorAll(s));
      const $  = (s, root=document) => root.querySelector(s);
      const clamp = (n, min, max) => Math.min(max, Math.max(min, n));

      /* =========================
        HERO: typewriter + entrance
      ========================== */
      const hero = $(".hero");
      const titleEl = $("#hero-title");
      const subtitleEl = $("#hero-subtitle");
      const scrollHint = $("#scroll-hint");
      const landingVideo = $("#landing-video");
      const typeTargets = [titleEl, subtitleEl].filter(Boolean);
      const heroEntrances = $$(".hero-entrance");
      let hasRun = false;

      typeTargets.forEach((el) => {
        const text = el.dataset.text || el.textContent.trim();
        el.dataset.text = text;
        el.textContent = "";
      });

      const typeText = (el, speed = 85) =>
        new Promise((resolve) => {
          const text = el.dataset.text || "";
          let index = 0;
          el.classList.add("typing");
          const tick = () => {
            el.textContent += text.charAt(index);
            index += 1;
            if (index < text.length) setTimeout(tick, speed);
            else {
              el.classList.remove("typing");
              el.classList.add("done");
              resolve();
            }
          };
          tick();
        });

      const startSequence = async () => {
        if (hasRun) return;
        hasRun = true;
        heroEntrances.forEach((item) => item.classList.add("is-visible"));
        for (const el of typeTargets) await typeText(el);
        requestAnimationFrame(() => setTimeout(() => scrollHint?.classList.add("visible"), 350));
      };

      if ("IntersectionObserver" in window && hero) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              startSequence();
              observer.disconnect();
            }
          });
        }, { threshold: 0.35 });
        observer.observe(hero);
      } else {
        startSequence();
      }

      /* =========================
        Landing video: keep muted autoplay
      ========================== */
      if (landingVideo) {
        const attemptPlay = () => {
          const p = landingVideo.play();
          if (p && typeof p.then === "function") p.catch(() => {});
        };
        attemptPlay();
      }

      /* =========================
        Reveal on scroll
      ========================== */
      const revealEls = $$(".reveal");
      if ("IntersectionObserver" in window) {
        const revealObs = new IntersectionObserver((entries) => {
          entries.forEach((e) => { if (e.isIntersecting) e.target.classList.add("is-visible"); });
        }, { threshold: 0.18 });
        revealEls.forEach((el) => revealObs.observe(el));
      } else {
        revealEls.forEach((el) => el.classList.add("is-visible"));
      }

      /* =========================
        Sticky mini nav active state
      ========================== */
      const navLinks = $$(".mini-nav a[data-section]");
      const sections = navLinks.map(a => document.getElementById(a.dataset.section)).filter(Boolean);
      const setActive = (id) => navLinks.forEach(a => a.classList.toggle("active", a.dataset.section === id));

      if ("IntersectionObserver" in window && sections.length) {
        const secObs = new IntersectionObserver((entries) => {
          const visible = entries.filter(e => e.isIntersecting).sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
          if (visible) setActive(visible.target.id);
        }, { threshold: [0.22, 0.35, 0.5, 0.65] });
        sections.forEach(s => secObs.observe(s));
      }

      /* =========================
        Progress bar (page progress)
      ========================== */
      const progressFill = $("#progress-fill");
      const updateProgress = () => {
        if (!progressFill) return;
        const doc = document.documentElement;
        const scrollTop = doc.scrollTop || document.body.scrollTop;
        const scrollH = doc.scrollHeight - doc.clientHeight;
        const p = scrollH > 0 ? (scrollTop / scrollH) * 100 : 0;
        progressFill.style.width = `${clamp(p, 0, 100)}%`;
      };
      window.addEventListener("scroll", updateProgress, { passive: true });
      updateProgress();

      /* =========================
        Chapter 01 Sticky Compare
      ========================== */
      const compareMedia = $("#compare-media");
      const compareSteps = $$(".js-sticky-step");
      const setActiveStep = (steps, activeEl) => steps.forEach(s => s.classList.toggle("is-active", s === activeEl));

      if (compareMedia && compareSteps.length && "IntersectionObserver" in window) {
        const obs = new IntersectionObserver((entries) => {
          const candidates = entries.filter(e => e.isIntersecting);
          if (!candidates.length) return;
          candidates.sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
          const top = candidates[0].target;

          setActiveStep(compareSteps, top);
          const src = top.dataset.media;
          if (src && compareMedia.getAttribute("src") !== src) compareMedia.src = src;
        }, { threshold: [0.35, 0.5, 0.65, 0.8] });

        compareSteps.forEach(s => obs.observe(s));
      }

      /* =========================
        Chapter 02 Sticky Narrative: keep loop playing + swap poster hint
      ========================== */
      const loopVideo = $("#redpacket-loop");
      if (loopVideo) {
        const tryPlay = () => {
          const p = loopVideo.play();
          if (p && typeof p.then === "function") p.catch(() => {});
        };
        tryPlay();
      }

      const steps2 = $$(".js-sticky-step-2");
      if (steps2.length && "IntersectionObserver" in window) {
        const obs2 = new IntersectionObserver((entries) => {
          const candidates = entries.filter(e => e.isIntersecting);
          if (!candidates.length) return;
          candidates.sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
          const top = candidates[0].target;

          setActiveStep(steps2, top);

          const media = top.dataset.media;
          const kind = top.dataset.kind;
          if (loopVideo && media) {
            if (kind === "img" || kind === "poster") loopVideo.poster = media;
          }
        }, { threshold: [0.35, 0.5, 0.65, 0.8] });

        steps2.forEach(s => obs2.observe(s));
      }

      /* =========================
        Chapter 03: scroll-lit stage
      ========================== */
      const orderStage = $("#order-stage");
      const orderLines = $$(".js-order-line");
      if (orderStage && orderLines.length && "IntersectionObserver" in window) {
        const obs3 = new IntersectionObserver((entries) => {
          const any = entries.some(e => e.isIntersecting);
          if (any) orderStage.classList.add("is-lit");
        }, { threshold: 0.55 });

        orderLines.forEach(l => obs3.observe(l));
      } else if (orderStage) {
        orderStage.classList.add("is-lit");
      }

      /* =========================
        Chapter 04 Horizontal scroll: 結合兩組邏輯
      ========================== */
      const hscrollSection = $("#chapter-elements");
      const track = $("#hscroll-track");
      const spacer = $("#hscroll-spacer");
      const head = hscrollSection ? hscrollSection.querySelector(".hscroll-head") : null;
      const panels = track ? track.querySelectorAll(".panel").length : 0;

      const getNavH = () => {
        const style = getComputedStyle(document.documentElement);
        return parseFloat(style.getPropertyValue("--navH")) || 92;
      };

      const setSpacerHeight = () => {
        if (!spacer || panels < 2) return;
        const vh = window.innerHeight;
        spacer.style.height = `${(panels - 1) * vh + Math.round(vh * 0.4)}px`;
      };

      const updateHScroll = () => {
        if (!hscrollSection || !track || panels < 2) return;

        const navH = getNavH();
        const sectionTop = hscrollSection.offsetTop;
        const headH = head ? head.offsetHeight : 0;
        const pin = hscrollSection.querySelector(".hscroll-pin");

        if (!pin || !spacer) return;

        const pinStart = sectionTop + headH;
        const pinEnd = pinStart + spacer.offsetHeight;

        const y = window.scrollY + navH;
        const denom = (pinEnd - pinStart) || 1;
        const t = clamp((y - pinStart) / denom, 0, 1);

        const x = t * (panels - 1) * window.innerWidth;
        track.style.transform = `translateX(-${x}px)`;
      };

      if (hscrollSection && track && spacer) {
        setSpacerHeight();
        updateHScroll();
        window.addEventListener("scroll", updateHScroll, { passive: true });
        window.addEventListener("resize", () => { setSpacerHeight(); updateHScroll(); });
      }

      /* =========================
        Chapter 05 Scrolled Video: 支持多來源影片替換 (來自第一組邏輯)
      ========================== */
      const svVideo = $("#sv-video");
      const svSource = $("#sv-source");
      const svLines = $$(".js-sv-line");

      const setActiveLine = (activeEl) => svLines.forEach(l => l.classList.toggle("is-active", l === activeEl));

      // 替換影片來源的邏輯 (來自第一組)
      const swapVideoSrcIfNeeded = (src, poster) => {
        if (!svVideo || !svSource) return;
        const cur = svSource.getAttribute("src");
        if (src && src !== cur) {
          svVideo.pause();
          svSource.setAttribute("src", src);
          if (poster) svVideo.poster = poster;
          svVideo.load();
        } else if (poster) {
          svVideo.poster = poster;
        }
      };

      if (svVideo && svLines.length && "IntersectionObserver" in window) {
        const obs5 = new IntersectionObserver((entries) => {
          const candidates = entries.filter(e => e.isIntersecting);
          if (!candidates.length) return;
          candidates.sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
          const top = candidates[0].target;

          setActiveLine(top);

          const src = top.dataset.src;
          const poster = top.dataset.poster;
          const t = parseFloat(top.dataset.time || "0");

          // 替換影片來源
          swapVideoSrcIfNeeded(src, poster);

          if (Number.isFinite(t)) {
            const jump = () => {
              if (Math.abs(svVideo.currentTime - t) > 0.45) svVideo.currentTime = t;
              const p = svVideo.play();
              if (p && typeof p.then === "function") p.catch(() => {});
            };
            // 如果來源改變，給影片一點時間載入再跳轉
            if (svSource.getAttribute("src") !== src) setTimeout(jump, 80);
            else jump();
          }
        }, { threshold: [0.55, 0.7, 0.82] });

        svLines.forEach(l => obs5.observe(l));
      }

      /* =========================
        Modal
      ========================== */
      const backdrop = $("#modal-backdrop");
      const btnClose = $("#modal-close");
      const elTitle = $("#modal-title");
      const elSubtitle = $("#modal-subtitle");
      const elBody = $("#modal-body");
      const elMedia = $("#modal-media");
      const elCaption = $("#modal-caption");
      let lastFocus = null;

      const escapeHtml = (str) => String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");

      const openModalFrom = (host) => {
        if (!backdrop) return;
        lastFocus = document.activeElement;

        const title = host.dataset.title || "";
        const subtitle = host.dataset.subtitle || "";
        const body = host.dataset.body || "";
        const mediaType = host.dataset.mediaType || "";
        const mediaSrc = host.dataset.mediaSrc || "";
        const mediaPoster = host.dataset.mediaPoster || "";
        const mediaCaption = host.dataset.mediaCaption || "";

        if (elTitle) elTitle.textContent = title;
        if (elSubtitle) elSubtitle.textContent = subtitle;
        if (elBody) elBody.innerHTML = `<p>${escapeHtml(body).replace(/\n/g, "<br>")}</p>`;

        if (elMedia) elMedia.innerHTML = "";
        if (elCaption) elCaption.textContent = mediaCaption;

        if (elMedia && mediaType === "video" && mediaSrc) {
          const v = document.createElement("video");
          v.controls = true;
          v.playsInline = true;
          v.preload = "metadata";
          if (mediaPoster) v.poster = mediaPoster;
          const s = document.createElement("source");
          s.src = mediaSrc;
          s.type = "video/mp4";
          v.appendChild(s);
          elMedia.appendChild(v);
        } else if (elMedia && mediaType === "img" && mediaSrc) {
          const img = document.createElement("img");
          img.src = mediaSrc;
          img.alt = `${title} 相關圖片`;
          img.loading = "lazy";
          img.decoding = "async";
          elMedia.appendChild(img);
        }

        backdrop.classList.add("open");
        backdrop.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
        btnClose?.focus();
      };

      const closeModal = () => {
        if (!backdrop) return;
        backdrop.classList.remove("open");
        backdrop.setAttribute("aria-hidden", "true");
        if (elMedia) elMedia.innerHTML = "";
        if (elBody) elBody.innerHTML = "";
        if (elCaption) elCaption.textContent = "";
        document.body.style.overflow = "";
        if (lastFocus) lastFocus.focus();
      };

      $$(".js-open-modal").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          const panel = e.target.closest(".panel");
          if (panel) openModalFrom(panel);
        });
      });

      btnClose?.addEventListener("click", closeModal);
      backdrop?.addEventListener("click", (e) => { if (e.target === backdrop) closeModal(); });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && backdrop?.classList.contains("open")) closeModal();
      });

      // 移除第一組多餘的 smooth scroll，因為已在 CSS 中設定
    });
  </script>
</body>
</html>
